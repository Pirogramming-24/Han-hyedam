{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'review_list.css' %}">
{% endblock %}

{% block content %}
<div class="header">
    <h1><a href="{% url 'reviews:review_list' %}">my<span>Movie</span>reviews</a></h1>
    <div>
        <a href="{% url 'reviews:chatbot_page' %}" class="chatbot-link">ğŸ¤– ì±—ë´‡</a>
        <a href="{% url 'reviews:create' %}" class="add-link">ë¦¬ë·° ì‘ì„±</a>
    </div>
</div>

<div class="search-bar">
    <form action="{% url 'reviews:search' %}" method="get">
        <input type="text" name="q" value="{{ query }}" placeholder="ì˜í™” ì œëª©, ê°ë…, ë°°ìš° ê²€ìƒ‰..." required>
        <button type="submit">ê²€ìƒ‰</button>
    </form>
</div>

<div class="search-header">
    {% if query %}
        <h2>"{{ query }}" ê²€ìƒ‰ ê²°ê³¼: {{ total }}ê°œ</h2>
        <a href="{% url 'reviews:review_list' %}" class="back-link">â† ì „ì²´ ëª©ë¡</a>
    {% endif %}
</div>

{% if reviews %}
<div class="grid">
    {% for review in reviews %}
    <div class="movie-card">
        <div class="poster">
            {% if review.poster_path %}
                <img src="https://image.tmdb.org/t/p/w500{{ review.poster_path }}" 
                     alt="{{ review.title }} í¬ìŠ¤í„°">
            {% else %}
                <div class="no-poster">í¬ìŠ¤í„° ì—†ìŒ</div>
            {% endif %}
        </div>
        <div class="movie-info">
            <a href="{% url 'reviews:detail' review.id %}" class="movie-title">{{ review.title }}</a>
            <p class="info-item">ê°œë´‰ë…„ë„: {{ review.release_year }}ë…„</p>
            <p class="info-item">ê°ë…: {{ review.director }}</p>
            <p class="info-item">ì¥ë¥´: {{ review.genre }}</p>
            <p class="info-item">ë³„ì : {{ review.rating }}</p>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="no-results">
    <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    <a href="{% url 'reviews:review_list' %}">ì „ì²´ ëª©ë¡ ë³´ê¸°</a>
</div>
{% endif %}

{% if page_obj.has_other_pages %}
<div class="pagination">
    {% if page_obj.has_previous %}
        <a href="?q={{ query }}&page=1">ì²˜ìŒ</a>
        <a href="?q={{ query }}&page={{ page_obj.previous_page_number }}">ì´ì „</a>
    {% else %}
        <span class="disabled">ì²˜ìŒ</span>
        <span class="disabled">ì´ì „</span>
    {% endif %}

    {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
            <span class="current">{{ num }}</span>
        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <a href="?q={{ query }}&page={{ num }}">{{ num }}</a>
        {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
        <a href="?q={{ query }}&page={{ page_obj.next_page_number }}">ë‹¤ìŒ</a>
        <a href="?q={{ query }}&page={{ page_obj.paginator.num_pages }}">ë</a>
    {% else %}
        <span class="disabled">ë‹¤ìŒ</span>
        <span class="disabled">ë</span>
    {% endif %}
</div>
{% endif %}

{% endblock %}