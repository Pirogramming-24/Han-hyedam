{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'review_detail.css' %}">
{% endblock %}

{% block content %}
<div class="header">
    <h1><a href="{% url 'reviews:review_list' %}">my<span>Movie</span>reviews</a></h1>
    <div>
        {% if user.is_authenticated %}
            <span style="color: #00ff41; margin-right: 10px;">{{ user.username }}ë‹˜</span>
            <a href="{% url 'reviews:logout' %}" class="logout-link">ë¡œê·¸ì•„ì›ƒ</a>
            <a href="{% url 'reviews:chatbot_page' %}" class="chatbot-link">ğŸ¤– ì±—ë´‡</a>
            <a href="{% url 'reviews:create' %}" class="add-link">ë¦¬ë·° ì‘ì„±</a>
        {% else %}
            <a href="{% url 'reviews:login' %}" class="login-link">ë¡œê·¸ì¸</a>
            <a href="{% url 'reviews:signup' %}" class="signup-link">íšŒì›ê°€ì…</a>
        {% endif %}
    </div>
</div>

<div class="detail-container">
    <div class="detail-header">
        <h2 class="movie-title-detail">{{ review.title }}</h2>
        {% if user == review.author %}
            <div class="action-buttons">
                <a href="{% url 'reviews:update' review.id %}">ìˆ˜ì •</a>
                <form action="{% url 'reviews:delete' review.id %}" method="post" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="delete-btn">ì‚­ì œ</button>
                </form>
            </div>
        {% endif %}
    </div>
    
    <div class="content-wrapper">
        <div class="poster-detail">
            {% if review.poster %}
                <img src="{{ review.poster.url }}" alt="{{ review.title }} í¬ìŠ¤í„°">
            {% elif review.poster_path %}
                <img src="https://image.tmdb.org/t/p/w500{{ review.poster_path }}" 
                    alt="{{ review.title }} í¬ìŠ¤í„°">
            {% else %}
                <div class="no-poster">í¬ìŠ¤í„° ì—†ìŒ</div>
            {% endif %}
        </div>
        
        <div class="info-wrapper">
            <p class="info-row"><strong>ê°œë´‰ë…„ë„</strong> {{ review.release_year }}ë…„</p>
            <p class="info-row"><strong>ê°ë…</strong> {{ review.director }}</p>
            <p class="info-row"><strong>ì£¼ì—°</strong> {{ review.actors }}</p>
            <p class="info-row"><strong>ì¥ë¥´</strong> {{ review.genre }}</p>
            <p class="info-row"><strong>ë³„ì </strong> {{ review.rating }}</p>
            <p class="info-row"><strong>ëŸ¬ë‹íƒ€ì„</strong> {{ hours }}ì‹œê°„ {{ minutes }}ë¶„</p>
        </div>
    </div>
    
    <div class="review-content">
        {{ review.content }}
    </div>

    <div class="like-section">
        {% if user.is_authenticated %}
            <form method="post" action="{% url 'reviews:like_toggle' review.pk %}">
                {% csrf_token %}
                {% if is_liked %}
                    <button type="submit" class="like-btn liked">
                        â¤ï¸ ì¢‹ì•„ìš” {{ review.likes.count }}
                    </button>
                {% else %}
                    <button type="submit" class="like-btn">
                        ğŸ¤ ì¢‹ì•„ìš” {{ review.likes.count }}
                    </button>
                {% endif %}
            </form>
        {% else %}
            <p class="like-login-required">
                <a href="{% url 'reviews:login' %}">ë¡œê·¸ì¸</a>í•˜ê³  ì¢‹ì•„ìš”ë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”! 
                (í˜„ì¬ {{ review.likes.count }}ëª…ì´ ì¢‹ì•„í•©ë‹ˆë‹¤)
            </p>
        {% endif %}
    </div>
    
    <div class="comments-section">
        <h3>ğŸ’¬ ëŒ“ê¸€ ({{ comments.count }})</h3>
        
        {% if user.is_authenticated %}
            <form method="post" action="{% url 'reviews:comment_create' review.pk %}" class="comment-form">
                {% csrf_token %}
                {{ comment_form.content }}
                <button type="submit" class="comment-submit">ëŒ“ê¸€ ì‘ì„±</button>
            </form>
        {% else %}
            <p class="login-required">ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ <a href="{% url 'reviews:login' %}">ë¡œê·¸ì¸</a>ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
        {% endif %}
        
        <div class="comments-list">
            {% for comment in comments %}
                <div class="comment-item">
                    <div class="comment-header">
                        <strong>{{ comment.author.username }}</strong>
                        <span class="comment-date">{{ comment.created_at|date:"Y-m-d H:i" }}</span>
                    </div>
                    <p class="comment-content">{{ comment.content }}</p>
                    {% if user == comment.author %}
                        <form method="post" action="{% url 'reviews:comment_delete' comment.pk %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="comment-delete">ì‚­ì œ</button>
                        </form>
                    {% endif %}
                </div>
            {% empty %}
                <p class="no-comments">ì²« ëŒ“ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}