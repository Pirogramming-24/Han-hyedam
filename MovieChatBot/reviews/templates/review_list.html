{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'review_list.css' %}">
{% endblock %}

{% block content %}
<div class="header">
    <h1><a href="{% url 'reviews:review_list' %}">my<span>Movie</span>reviews</a></h1>
    <div>
        {% if user.is_authenticated %}
            <span style="color: #00ff41; margin-right: 10px;">{{ user.username }}ë‹˜</span>
            <a href="{% url 'reviews:logout' %}" class="logout-link">ë¡œê·¸ì•„ì›ƒ</a>
            <a href="{% url 'reviews:chatbot_page' %}" class="chatbot-link">ğŸ¤– ì±—ë´‡</a>
            <a href="{% url 'reviews:create' %}" class="add-link">ë¦¬ë·° ì‘ì„±</a>
        {% else %}
            <a href="{% url 'reviews:login' %}" class="login-link">ë¡œê·¸ì¸</a>
            <a href="{% url 'reviews:signup' %}" class="signup-link">íšŒì›ê°€ì…</a>
        {% endif %}
    </div>
</div>

<div class="stats-section">
    <div class="stat-card">
        <div class="stat-number">{{ total_count }}</div>
        <div class="stat-label">ì´ ì˜í™”</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ tmdb_count }}</div>
        <div class="stat-label">TMDB ì˜í™”</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ user_count }}</div>
        <div class="stat-label">USER</div>
    </div>
</div>

<div class="search-bar">
    <form action="{% url 'reviews:search' %}" method="get">
        <input type="text" name="q" placeholder="ì˜í™” ì œëª©, ê°ë…, ë°°ìš° ê²€ìƒ‰..." required>
        <button type="submit">ê²€ìƒ‰</button>
    </form>
</div>

<div class="filter-section">
    <strong>í•„í„°:</strong>
    <a href="?filter=all&sort={{ request.GET.sort }}" class="filter-btn {% if filter_type == 'all' %}active{% endif %}">ì „ì²´</a>
    <a href="?filter=tmdb&sort={{ request.GET.sort }}" class="filter-btn {% if filter_type == 'tmdb' %}active{% endif %}">TMDB</a>
    <a href="?filter=user&sort={{ request.GET.sort }}" class="filter-btn {% if filter_type == 'user' %}active{% endif %}">USER</a>
</div>

<div class="sort-bar">
    <div class="sort-bar-content">
        <strong>ì •ë ¬:</strong>
        <a href="?filter={{ filter_type }}&sort=-created_at">ìµœì‹  ì‘ì„±ìˆœ</a> |
        <a href="?filter={{ filter_type }}&sort=title">ì œëª© ì´ë¦„ìˆœ</a> |
        <a href="?filter={{ filter_type }}&sort=rating">ë³„ì  ë†’ì€ ìˆœ</a> |
        <a href="?filter={{ filter_type }}&sort=running_time">ìƒì˜ì‹œê°„ ì§§ì€ ìˆœ</a> |
        <a href="?filter={{ filter_type }}&sort=release_year">ìµœì‹  ê°œë´‰ìˆœ</a>
    </div>
</div>

<div class="grid">
    {% for review in reviews %}
    <div class="movie-card">
        {% if review.is_tmdb %}
            <span class="tmdb-badge">TMDB</span>
        {% endif %}
        
        <div class="poster">
            {% if review.poster %}
                <img src="{{ review.poster.url }}" alt="{{ review.title }} í¬ìŠ¤í„°">
            {% elif review.poster_path %}
                <img src="https://image.tmdb.org/t/p/w500{{ review.poster_path }}" 
                    alt="{{ review.title }} í¬ìŠ¤í„°">
            {% else %}
                <div class="no-poster">í¬ìŠ¤í„° ì—†ìŒ</div>
            {% endif %}
        </div>
        <div class="movie-info">
            <a href="{% url 'reviews:detail' review.id %}" class="movie-title">{{ review.title }}</a>
            <p class="info-item">ê°œë´‰ë…„ë„: {{ review.release_year }}ë…„</p>
            <p class="info-item">ì¥ë¥´: {{ review.genre }}</p>
            <p class="info-item">ë³„ì : {{ review.rating }}</p>
        </div>
    </div>
    {% endfor %}
</div>

{% if page_obj.has_other_pages %}
<div class="pagination">
    {% if page_obj.has_previous %}
        <a href="?page=1&filter={{ filter_type }}&sort={{ request.GET.sort }}">ì²˜ìŒ</a>
        <a href="?page={{ page_obj.previous_page_number }}&filter={{ filter_type }}&sort={{ request.GET.sort }}">ì´ì „</a>
    {% else %}
        <span class="disabled">ì²˜ìŒ</span>
        <span class="disabled">ì´ì „</span>
    {% endif %}

    {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
            <span class="current">{{ num }}</span>
        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <a href="?page={{ num }}&filter={{ filter_type }}&sort={{ request.GET.sort }}">{{ num }}</a>
        {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}&filter={{ filter_type }}&sort={{ request.GET.sort }}">ë‹¤ìŒ</a>
        <a href="?page={{ page_obj.paginator.num_pages }}&filter={{ filter_type }}&sort={{ request.GET.sort }}">ë</a>
    {% else %}
        <span class="disabled">ë‹¤ìŒ</span>
        <span class="disabled">ë</span>
    {% endif %}
</div>
{% endif %}

{% endblock %}